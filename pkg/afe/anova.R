#' @exportglm.long <- function(id, between, within, dv, data, covariate, na.rm = FALSE, type = 3) {		if (missing(covariate)) {		covariate <- NULL		covariates <- NULL	} else covariates <- str_c(covariate, collapse = "+")	lh1 <- str_c(id, str_c(between, collapse = "+"), covariates, sep = "+")	rh1 <- str_c(within, collapse = "+")	rh2 <- str_c(str_c(between, collapse = "*"), covariates, sep = "+")	rh3 <- str_c(within, collapse = "*")	tmp.dat <- dcast(data, formula = as.formula(str_c(lh1, rh1, sep = "~")), fun.aggregate = mean, na.rm = na.rm, value.var = dv)	within.levels <- lapply(lapply(data[,within], levels), factor)	idata <- rev(expand.grid(rev(within.levels)))	tmp.lm <- lm(as.formula(str_c("cbind(",str_c(colnames(tmp.dat[-(seq_along(c(id, between, covariate)))]), collapse = ", "), ") ~ ", rh2)), data = tmp.dat)	tmp.res <- Anova(tmp.lm, idata = idata, idesign = as.formula(str_c("~", rh3)), type = type)	summary(tmp.res, multivariate = FALSE)}#' @exportaov.car <- function(formula, data, na.rm = FALSE, type = 3) {	browser()	vars <- all.vars(formula)	dv <- vars[1]	vars <- vars[-1]	parts <- attr(terms(formula, "Error", data = data), "term.labels")	error.term <- parts[str_detect(parts, "^Error\\(")]	id <- all.vars(parse(text = error.term))[1]	within <- all.vars(parse(text = error.term))[-1]	between <- vars[!(vars %in% c(id, within))]		effect.parts <- parts[!str_detect(parts, "^Error\\(")]	effect.parts.no.within <- effect.parts[!str_detect(effect.parts, str_c("\\<",within,"\\>", collapse = "|"))]	rh2 <- str_c(effect.parts.no.within, collapse = "+")	lh1 <- str_c(id, str_c(between, collapse = "+"), sep = "+")	rh1 <- str_c(within, collapse = "+")	rh3 <- str_c(within, collapse = "*")	tmp.dat <- dcast(data, formula = as.formula(str_c(lh1, rh1, sep = "~")), fun.aggregate = mean, na.rm = na.rm, value.var = dv)		within.levels <- lapply(lapply(data[,within], levels), factor)	idata <- rev(expand.grid(rev(within.levels)))		tmp.lm <- lm(as.formula(str_c("cbind(",str_c(colnames(tmp.dat[-(seq_along(c(id, between)))]), collapse = ", "), ") ~ ", rh2)), data = tmp.dat)	tmp.res <- Anova(tmp.lm, idata = idata, idesign = as.formula(str_c("~", rh3)), type = type)	summary(tmp.res, multivariate = FALSE)}